global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    region: 'ap-guangzhou'

rule_files:
  - "rules.yml"

# 配置 Alertmanager
alerting:
  alertmanagers:
    - static_configs:
        # Prometheus 和 Alertmanager 都在 Docker 网络中，直接用服务名
        - targets: ['alertmanager:9093']

scrape_configs:
  # 1. 监控 Prometheus 自身
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # 2. 监控宿主机 (Node Exporter)
  - job_name: 'linux-server'
    static_configs:
      # Node Exporter 也在 Docker 网络中，直接用服务名
      - targets: ['node-exporter:9100']
        labels:
          host_alias: 'prod-server'
          region: 'ap-chongqing'

  # 3. 监控 Java 应用 (ZhiWei Agent)
  - job_name: 'zhiwei-agent'
    metrics_path: '/actuator/prometheus'
    static_configs:
      # Java 应用运行在宿主机，通过 host.docker.internal 访问
      # (前提：docker-compose.yml 中配置了 extra_hosts)
      - targets: ['host.docker.internal:9901']
        labels:
          region: 'ap-chongqing'
          env: 'prod'